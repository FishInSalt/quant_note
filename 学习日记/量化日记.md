# 量化日记


## 2025/12/24
对于庄家盘，散户要做什么，后续庄家就反着做，可以根据这个特征跟庄下注

对于庄家盘，不仅要分析技术指标，更要分析散户行为的指标，以预判庄家的操作

对于庄家盘，盈利点如下：
1、现货低买后在出货价卖出
2、合约中同步做多
3、在出货阶段合约做空
（要预判准庄家的行为）

要预判的因素：
1、散户的突破点位
2、庄家的震荡点位

高频/短线交易

## 2025/12/23
对于永续合约，有哪些盈利策略，以及有哪些风险点需要注意？
了解庄家拉升和出货的逻辑


个人永续合约盈利经验：分析k线图，挂个预判单，具体为:
1、限价买/卖单，并且设置止损止盈点，
2、止损点比止盈点离进场点更近，即预判失败及时离场，成本为手续费+（进场-止损价差）
3、如果预判成功率>60%，应该可以盈利，且不用盯盘
4、预判成功率的关键：利用区间震荡，见好就收，不要有任何幻想  
5、该方式适合量化
6、杠杆越大，操作要求越高，操作时间越短（否则震荡会可能会强平）

### 庄家为什么会赢
1、专业玩家，掌握市场绝大多数信息（相当赌骰子，庄家能看到所有人的下注，并且可以低成本改骰子点数）
2、散户的止盈止损大多中庸，会被庄家精准打击，然后被收割（买对了，但是没活到终点）
3、剩下激进的散户，操作错误的也会被收割（上涨卖空或者下跌买多）。没被收割的在高风险投资中无法找到精准的止盈点，即无法完全兑现高风险带来的高收益。
4、庄家 成本：操控市场价格的成本；盈利：大多数散户的钱。因此庄家需要**最小化操纵市场价格的成本**以获取最大收益
5、散户 大多被收割，或爆仓或割肉离场；少数盈利也是高风险下的中等收益。最终所有散户的收益期望均为0。


### 量化交易者的盈利点
1、实时监控市场，类似盯盘
2、精准下单，相比人工下单有更少的滑点成本
3、自动化判断市场趋势，赚取市场波动（庄家操盘，散户进场）中低买高卖的收益。
4、也就是说，量化交易者最有可能成为散户中，极少数能够盈利的人（所有操作都是策略最优解）






## 2025/12/22


### 庄家操盘出货时机如何捕捉？
详见 加密货币/庄家出货信号.md

简洁总结：

```
第一步：持续监控关键信号

重点观察：
1. 资金费率变化（这是最重要的！）
   └─ 当资金费率从-1.5%转向正值时，进入警戒状态
   └─ 当资金费率超过+0.5%时，可以考虑开始建仓做空

2. 价格行为
   └─ 如果再次冲击4.52失败，是做空信号
   └─ 如果出现看跌吞没或黄昏星，是强信号

3. 成交量
   └─ 如果再次放出天量但价格不涨，是强烈信号

第二步：等待入场时机

最佳入场条件（至少满足2-3个）：
□ 资金费率转正且>+0.3%
□ 价格第二次或第三次冲高失败
□ 出现明确的反转K线形态
□ 放量滞涨
□ 跌破4.0支撑位

第三步：执行交易

入场价位：根据信号出现时的价格
仓位：$100全部（既然你说可以全亏）
杠杆：建议5倍（平衡风险和收益）
止损：设在入场价上方10-15%的位置

举例：
- 如果在4.3入场做空
- 止损设在4.8（约12%）
- 目标看3.5-3.8（约12-20%收益）
- 风险收益比约1:1到1:1.5
```



## 2025/12/21


#### 小币种庄家操盘问题
问claude，在永续合约中，大户可以通过操盘收割吗？具体怎么操作？
作为普通投资者，为避免这些风险，有哪些建议？
如果大户能通过这些信息差操控市场，散户可以通过哪些方式减少信息差
那么当K线图出现一根插针的时候，意味着哪些信息？插针的底部的价格对我们有什么启示？
详见 加密货币/币圈大户的操盘问题-claude回答.md

真实的币圈中，是否有反技术策略，专门收割技术派的钱。（启示：合约市场加杠杆后，技术派的指标会被大户利用制造虚假信号；所以技术派最好不要加杠杆）



freqtrade学习

了解币圈中的理财产品：流动性挖矿/DeFi
1、 x * y = z， 自动做市商
2、付出：参与者给提供存入两种代币，为自动做市商提供流动性
3、回报：自动做市商可获得交易手续费、以及流动性挖矿奖励（治理代币如uni、sushi）
## 2025/12/20
手动实战永续合约，了解合约的玩法

## 2025/12/19

了解下通过claude快速学习一个项目的技巧（找视频和资料）
开始学习freqtrade这个工具（跟着claude学习这个项目）

freqtrade问题记录：
如何通过hyperopt和IntParameter进行参数优化？

## 2025/12/18

**加密货币的很多波动都出现在23:00附近**

**加密货币是如何发行的？在meme币的案例中，似乎发行一种加密货币非常方便，好像人人都可以无成本地发行一款加密货币。事实是这样吗？**
两种情况：
1、代表整条区块链的币。
    1.1、全新独立的区块链的币，发行需要开发整条区块链，资金、人力和时间成本都很高。BTC、ETH、SOL
    1.2、fork其他区块链源码，并调整参数，发行的币：人力、时间成本低，但资金成本依旧很高。DOGE币
2、在区块链上扩展的币。只需写智能合约，成本很低。Meme币

```
【两种加密资产的本质区别】

┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│         Coin（币）                    Token（代币）              │
│         独立区块链                    依附现有区块链              │
│                                                                 │
│    ┌─────────────────┐          ┌─────────────────┐            │
│    │                 │          │   Ethereum      │            │
│    │    Bitcoin      │          │   ┌─────────┐   │            │
│    │    区块链        │          │   │ USDT    │   │            │
│    │                 │          │   │ UNI     │   │            │
│    │    BTC          │          │   │ LINK    │   │            │
│    │                 │          │   │ SHIB    │   │            │
│    └─────────────────┘          │   │ PEPE    │   │            │
│                                 │   └─────────┘   │            │
│    ┌─────────────────┐          │                 │            │
│    │                 │          └─────────────────┘            │
│    │    Ethereum     │                                         │
│    │    区块链       │          ┌─────────────────┐            │
│    │                 │          │   Solana        │            │
│    │    ETH         │          │   ┌─────────┐   │            │
│    │                 │          │   │ BONK    │   │            │
│    └─────────────────┘          │   │ WIF     │   │            │
│                                 │   │ JUP     │   │            │
│    ┌─────────────────┐          │   └─────────┘   │            │
│    │                 │          │                 │            │
│    │    Solana       │          └─────────────────┘            │
│    │    区块链       │                                         │
│    │                 │                                         │
│    │    SOL         │                                         │
│    │                 │                                         │
│    └─────────────────┘                                         │
│                                                                 │
│    难度：极高                     难度：极低                     │
│    成本：数百万美元               成本：几美元到几百美元          │
│    时间：数年                     时间：几分钟到几小时            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 详细对比

| 维度 | Coin（独立区块链） | Token（链上代币） |
|------|-------------------|------------------|
| **技术要求** | 需要开发整条区块链 | 只需写智能合约 |
| **开发成本** | $500K - $50M+ | $0 - $1,000 |
| **开发时间** | 1-5年 | 几分钟到几天 |
| **安全性** | 需要自己保障 | 依赖底层链 |
| **需要矿工/验证者** | 是 | 否 |
| **代表** | BTC, ETH, SOL | USDT, UNI, SHIB |


**智能合约是什么？**
```
┌─────────────────────────────────────────────────────────────────┐
│                    智能合约核心要点                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 本质                                                        │
│     智能合约 = 部署在区块链上的自动执行程序                      │
│                                                                 │
│  2. 特点                                                        │
│     - 代码公开透明                                              │
│     - 部署后不可修改                                            │
│     - 自动执行，不可阻止                                        │
│     - 运行在所有节点上                                          │
│                                                                 │
│  3. 执行                                                        │
│     - 用户发送交易触发                                          │
│     - EVM 执行字节码                                            │
│     - 消耗 Gas 作为费用                                         │
│     - 结果写入区块链                                            │
│                                                                 │
│  4. 开发                                                        │
│     - 主要使用 Solidity 语言                                    │
│     - 编译成字节码部署                                          │
│     - 需要安全审计                                              │
│                                                                 │
│  5. 应用                                                        │
│     - 代币（ERC-20）                                            │
│     - NFT（ERC-721）                                            │
│     - DeFi（DEX、借贷、衍生品）                                 │
│     - DAO、游戏、社交等                                         │
│                                                                 │
│  6. 为什么发币容易                                              │
│     - 代币只是合约中的余额记录                                  │
│     - 标准化接口（ERC-20）                                      │
│     - 工具成熟，门槛极低                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```
```
【智能合约不能做的事】

┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  1. 不能主动执行                                                │
│     - 合约是被动的，需要外部触发                                │
│     - 不能"到时间自动执行"                                     │
│     - 需要 Keeper 网络或用户手动调用                           │
│                                                                 │
│  2. 不能访问链下数据                                            │
│     - 不能调用 API                                             │
│     - 不能获取网页内容                                         │
│     - 需要预言机（Oracle）提供外部数据                         │
│                                                                 │
│  3. 不能生成真随机数                                            │
│     - 区块链要求确定性                                         │
│     - 链上"随机"可被预测和操纵                                 │
│     - 需要 VRF（可验证随机函数）等方案                         │
│                                                                 │
│  4. 不能隐藏数据                                                │
│     - 所有状态变量都是公开的                                   │
│     - private 只是限制访问方式，不是真正隐私                   │
│     - 任何人都能读取合约存储                                   │
│                                                                 │
│  5. 不能修改已部署代码                                          │
│     - 代码一旦部署就不可变                                     │
│     - 需要代理模式实现"可升级"                                 │
│     - 但这增加了复杂性和中心化风险                             │
│                                                                 │
│  6. 计算能力有限                                                │
│     - Gas 限制了复杂度                                         │
│     - 不能做大量计算                                           │
│     - 不适合 AI、机器学习等                                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```


**加密货币分类的技术架构分类中，layer1、layer2、layer3和layer0是具体什么？**
Layer 2解决方案旨在从Layer 1网络分担部分交易负载，让基础层专注于安全性和去中心化，而Layer 2网络更高效地处理大量交易。这句话怎么理解？

【区块链不可能三角 (Blockchain Trilemma)】

                    去中心化
                   (Decentralization)
                        △
                       ╱ ╲
                      ╱   ╲
                     ╱     ╲
                    ╱       ╲
                   ╱    ❌    ╲
                  ╱   不可能    ╲
                 ╱   同时满足    ╲
                ╱       三者      ╲
               ╱                   ╲
              ▽─────────────────────▽
          安全性                  可扩展性
         (Security)              (Scalability)


含义：
- 去中心化：节点越多、越分散越好
- 安全性：抗攻击、不可篡改
- 可扩展性：处理大量交易的能力（TPS）

传统观点认为：三者只能取其二，不能兼得

【简洁总结】

Layer 0：区块链之间的"互联网"
         让不同链能够通信
         例：Polkadot, Cosmos

Layer 1：独立运行的基础区块链
         提供安全和最终结算
         例：Bitcoin, Ethereum, Solana

Layer 2：建立在L1上的扩展层
         处理大量交易，继承L1安全
         例：Arbitrum, Optimism, zkSync

Layer 3：建立在L2上的应用专用层
         为特定应用定制优化
         例：游戏链、社交链


## 2025/12/17

搞清楚永续合约和现货杠杆的玩法
追问问题：
加杠杆时，利息是按 (本金 * 杠杆) 的数额计算，还是 (本金 * (杠杆-1))的数额计算
合约价格为什么要锚定现货价格

搞清楚目前有哪些类型的加密货币，以及为什么会有这些类型的加密货币，不同类型的加密货币分别有什么用途
1、比特币
2、ETH、SOL
3、BNB,OKB等平台币
4、山寨币
5、meme币


感觉涉及区块链技术的项目，都会发行自己的加密货币，例如Defi代币、AI代币、meme币、预言机这些，是这样吗？为什么这些项目都会发行自己的加密货币？（答：因为这些代币在产生它们的地方都发挥着一些作用，例如作为消耗代币，治理代币等）



### 永续合约

#### 是什么
以保证金为担保，通过**杠杆**交易标的资产的**价格变动**，没有到期日，可以永久持有。
合约交易的底层逻辑其实是杠杆借贷。

#### 重点关注

永续合约的创新点：
1、无到期日（相比传统期货）
2、通过资金费使价格锚定现货

永续合约的核心价值
1、杠杆提高资金效率
2、可以双向交易
3、套期保值（所以要锚定现货价格？）

永续合约的开单要素：
1、保证金，用于覆盖杠杆带来的潜在亏损
2、全仓/逐仓，爆仓风险是否隔离
3、杠杆
4、资金费，系统自动计算，用于平衡过多或者过空，使合约价格回归现货价格

#### 常见策略类型

1、同现货
2、资金费套利：资金费率套利是指在现货和永续合约市场同时执行两笔交易，相同标的资产、相反方向、相等数量、盈亏对冲。目标是从永续合约交易中的资金费率获利
3、期现套利：永续合约价格与现货价格存在偏差时套利
4、期现对冲：现货持仓对冲。锁定当前价值，等待不确定性消除后解除对冲


### 现货杠杆

#### 是什么
现货杠杆交易（Margin Trading） 是指向交易所借入资金或资产，用于放大现货交易规模的交易方式。

#### 重点关注
1、向交易所借款实现杠杆。现货杠杆的核心成本是借款利息，这是与永续合约最大的区别之一。利率会根据市场供需浮动，牛市时USDT借贷需求大，利率会上升。
2、有保证金和强平机制
3、可以获得资产所有权（同现货交易），但是需要把借款还清
4、适合场景：短期投机、需要真是资产、中等杠杆
5、独特使用场景：“真实”做空，例如向交易所借BTC卖出，然后价格下跌后买回还给交易所，盈利=做空价差-利息


## 2025/12/16

阶段总结：
1、主流的投资方式是现货交易和合约交易
2、期权门槛较高，可以在充分了解现货和合约之后去学习
3、现货杠杆

现阶段搞明白现货和合约的各种玩法（如何加杠杆），还有现货杠杆

### 现货

#### 是什么

最原始的交易方式：物品-货币交易。用货币买入获得物品所有权，或者出售物品换取货币。
底层机制：
1、订单簿：记录所有买入和卖出的订单
2、撮合引擎：自动匹配所有可以成交的买入/卖出订单对

#### 重点关注

订单类型（**重点**）
基础订单类型：
1、市价单：以当前市场最佳价买入/卖出。特点：立即成交，消耗市场流动性。（主动成交，即时成交）
2、限价单：以用户设置的价格买入/卖出。特点：不保证成交，提供市场流动性。（被动成交，成交时间不确定）
3、止盈止损单：以用户设置的止盈/止损点卖出。特点：只有卖出单，需要先买入后，才能创建该类型订单（被动成交，成交时间不确定）

高级订单类型：
1、止损限价单：以市价单创建，当价格滑点到止损点，转成限价单
2、OCO顶单：同时创建止盈单和止损单，当其中一个订单成交触发时，另一个订单取消
3、冰山订单：只显示订单的部分信息。用于隐藏交易意图
4、FOK订单：全部成交或者全部取消，用于确保完整成交
5、IOC订单：立即成交部分，剩余取消，用于快速部分成交（感觉类似止损限价单的优化版）
6、GTC订单：一直有效直到成交或者取消。用于长期挂单
7、GTD订单：指定日期前有效。用于短期挂单

#### 常见策略类型

基础策略：
1、买入持有。最原始的交易策略
2、定投。优势：平滑买入成本，适合长期看多
3、网格交易（类似均值回归策略）：在价格区间设置多个买卖点，自动低买高卖
趋势/动量策略
4、均值回归：通过某均线价格+波动阈值确定买卖信号，低买高卖。
5、动量策略：计算收益率和收益率增速。收益率为正，且增速变大，买入；增速变小，卖出
6、双均线策略：计算短期均线价格和长期均线价格，两者价格交叉时产生买卖信息，短线上穿长线买入；短线下穿长线时卖出
套利策略
7、跨交易所套利：通过不同交易所的同一资产的价差进行套利，当价差大于交易成本时盈利
8、统计套利：原理是假设相关性高的两个资产相关系数长期是固定的。当短期相关系数偏离时，可以通过买入低估资产，卖出高估资产盈利
6、做市：同时挂买单和卖单，利用买卖价差盈利。（也为市场提供了流动性）

#### 交易成本

1、手续费
2、滑点
3、买卖价差（使用往返买卖策略时才需要考虑）

#### 产品优劣

优势：
✅ 最大亏损有限（最多亏完本金）
✅ 无强平风险
✅ 无持仓成本（无资金费率）
✅ 可以真正拥有资产
✅ 适合长期持有

劣势：
❌ 只能做多，无法直接做空
❌ 资金效率较低（无杠杆）
❌ 熊市中被动挨打
❌ 大资金进出有滑点



## 2025/12/15

币安的重要功能：
1、C2C充值/提现。（充值基本无风险、提现可能有资金冻结风险，提现要用一张专用卡，并且是地方小银行的卡）
2、金融产品：现货、合约（做多/做空，更高风险）（熟悉app上手动买入的操作，比如限价单市价单止盈止损买入卖出、杠杆等）
3、跟单交易：类似委托基金经理投资（可查看交易员的具体交易记录，重点关注交易员的盈亏、回撤数据）
4、交易机器人（策略）：自定义量化交易策略
5、活期存款：借币给交易所获取活期利率（本质是其他人会想交易所借贷，因此有需求）
6、LaunchPad：类似新币上市（低成本买入，基本能参与都赚钱）
7、双币投资：有风险的理财产品，不建议购买。盈利方式只有纯赚利息，但纯赚利息的方式只有在没有熊市/牛市没有冲破支撑位/阻力位的时候才出现。其他情况：熊市亏损，牛市少赚钱。非常鸡肋的一个产品


合约三个价格的原理和用途
1、最新价：最新成交的价格（分买单卖单），用于了解该交易所中某产品的最新成交价格
2、指数价：该产品在所有交易所中的加权平均价格，用于判断产品的趋势和是否稳定
3、标记价：指数价+通过合约价格计算的微小偏移，交易所认为的公平价格，可以避免短期的价格操控，交易所使用该价格来触发强制平仓，因此交易员需要根据该价格（而非最新价）来判断自己的交易是否会爆仓


欧易的重要功能（相比币安多出的功能）：
1、DEX：参与土狗代币（也称meme币）投资，它们通常没有技术白皮书，由匿名团队发行，特点是低门槛、高波动、强投机性，依赖社区热度而价格暴涨暴跌，高风险投机工具（即赌博）
2、盘前交易：交易未上架到交易所的产品
3、期权：门槛高，可以不涉及
欧易主要盈利功能：
1、现货交易
2、合约交易
3、理财赚钱：
    3.1、活期/定期存款（存币赚币息）
    3.2、链上赚币（存币到链上赚币息）
    3.3、闪赚（有活动），本质是金融产品方与交易所合作，投资者参与活动可以获得交易所的存款利息+产品方的产品利息（空投）



## 2025/12/14

学习freqtrader项目
了解币安和欧易两个app中的功能（搜视频+资料+上手）

## 2025/12/13

整理一份加密货币的量化交易学习计划
了解现在有哪些现成的框架或者工具可以用来量化交易加密货币

## 2025/12/12
了解加密货币有哪些玩法
1、加密货币有哪些玩法（现货、合约、DEX、期权等）
2、这些玩法的原理
3、不同交易所是否支持不同玩法（欧易、币安）
4、对于不同交易所，有什么推荐（欧易、币安）

了解量化交易加密货币的流程
1、如何调交易所接口
2、调接口成本
3、接口有哪些
4、量化交易全流程整合



## 2025/12/11
了解加密货币如何进行量化交易（加密货币市场似乎跑量化交易成本较低）
了解 2025如何注册和入金加密货币交易所（binance、OKX）(已完成注册和入金)

## 2025/12/10
了解 多股票定时多因子调仓策略 的实现逻辑
完整运行多股票定时多因子调仓策略回测

了解QMT


## 2025/12/9
第一维度：分析和评估市场状况的各种指标（市场技术指标，动量、趋势、波动、成交量）

第二维度：分析和评估各种技术指标的方法论，即如何衡量某个技术指标的可靠性
指标分析方法论入门：基于IC的指标分析
IC是指信息系数（Information Coeffient），衡量两个指标之间的相关性（两个指标一般是指技术指标（自变量）和收益率（因变量））
基于IC指标的分析，常见的分析指标有
1、IC
2、IC均值
3、IC标准差
4、IR
5、IC正比例

分位数组合分析：用于检测因子对收益率的相关性（检测因子和收益率是否线性相关）
多空组合收益分析：衡量策略的的alpha因子（市场无关收益）最核心和最直接的指标




## 2025/12/7
多股票回测功能
验证多个策略的效果

## 2025/12/6
继续学习指标
趋势类指标：EMA、MACD
动量类：RSI、Stochastic、CCI
波动率类：布林带、ATR
成交量类：OBV、VWAP

详见 量化指标工具箱.md



## 2025/12/5
1、指标理解：回测的各种指标理解
### 收益类指标详解

| 指标 | 说明 | 解读与深层含义 |
| :--- | :--- | :--- |
| **`Return [%]`** <br> 总收益率 | 策略期间的累计收益 | **最直观的“成绩单”**。计算公式为：`(最终权益 - 初始权益) / 初始权益 * 100%`。它回答了“我的本金最终赚了百分之几”这个最基本的问题。**局限性**：完全忽略了获取这个收益所经历的过程（波动、回撤），无法与其他不同时长策略比较。 |
| **`Buy & Hold Return [%]`** <br> 买入持有收益 | 基准对比，策略应跑赢此值 | **策略的“及格线”或“机会成本”**。它指的是在回测期初，简单买入并持有某个基准资产（如沪深300指数、标的股票）直到期末所能获得的收益率。如果您的策略收益（`Return [%]`）长期无法跑赢这个值，那么策略的附加价值就存疑，因为承担了更多主动风险却没有获得超额回报。这是衡量策略**存在必要性**的关键指标。 |
| **`Return (Ann.) [%]`** <br> 年化收益率 | 换算成年化的收益率 | **标准化收益，用于横向比较**。它通过一个标准化的时间单位（年）来平滑不同时长策略的收益。计算公式通常为：`(1 + 总收益率)^(1/回测年数) - 1`。它让你可以初步比较一个运行3年的策略和一个运行5年的策略，谁的**平均每年**赚钱能力更强。**注意**：不同平台对此计算可能略有差异，有时会考虑复利和交易日天数进行更精确的折算。 |
| **`CAGR [%]`** <br> 复合年增长率 | 考虑复利的年化收益 | **衡量长期财富增长的黄金标准**。CAGR 是 **Compound Annual Growth Rate** 的缩写。它与“年化收益率”在概念和目的上**高度相似**，都是将总收益折算成年均收益。 <br><br> **关键区别与重要性**：<br> 1. **计算原理**：CAGR 是一个**几何平均**概念，计算的是从初始值增长到最终值所需的**恒定年增长率**。公式为：`CAGR = (Equity Final / Equity Initial)^(1/年数) - 1`。<br> 2. **平滑波动**：它完全抹平了过程中的所有波动，只关注起点和终点。这使得它成为比较不同策略、不同投资项目长期真实增长能力的**最佳单一指标**。<br> 3. **与`Return (Ann.)[%]`的关系**：在许多回测报告中，两者计算一致。但`Return (Ann.)`有时可能基于算术平均或简化的时间折算，而**CAGR 特指基于几何平均的精确计算**。当两者同时出现且数值不同时，**应优先信任CAGR**，因为它更准确地反映了复利效应。 |
| **`Equity Final [$]`** <br> 最终权益 | 账户最终价值 | **成果的绝对数额**。这是扣除所有成本和费用后，在回测结束那一刻您账户里的真实资金总额。它是计算总收益率和CAGR的基础。对于固定初始本金的策略，此值与`Return [%]`信息等价。 |
| **`Equity Peak [$]`** <br> 峰值权益 | 账户历史最高值 | **衡量回撤的基准点**。这个数字本身意义不大，但其重要性在于它是计算**最大回撤（Max Drawdown）** 的关键输入。最大回撤衡量的是从任意一个历史峰值权益下跌到之后低谷的幅度。因此，`Equity Peak` 记录了策略在历史上“最辉煌”的时刻，而随后的下跌幅度则揭示了其脆弱性。 |

### **综合解读与建议**

1.  **核心逻辑链**：
    *   您投入 **`Equity Initial`**（初始本金，通常隐含）。
    *   策略运行中，资产曾达到 **`Equity Peak`**（峰值）。
    *   最终，您获得 **`Equity Final`**（最终权益）。
    *   由此算出 **`Return [%]`**（总收益）。
    *   为了公平比较，将其折算为 **`CAGR [%]`**（复合年化收益）。
    *   同时，您需要将 **`CAGR`** 或 **`Return`** 与 **`Buy & Hold Return [%]`** 比较，判断策略是否创造了超额价值。

2.  **行动指南**：
    *   **首要检查**：您的策略 `Return` / `CAGR` 是否显著且持续地高于 `Buy & Hold Return`？如果不是，需要重新审视策略逻辑。
    *   **横向比较**：使用 **`CAGR`** 来与其他策略或投资产品进行长期收益率比较。
    *   **切勿孤立看待**：高收益（`CAGR`）可能伴随着高风险。接下来，您必须结合**最大回撤（需要`Equity Peak`数据）**、**波动率**和**夏普比率**等风险指标，才能全面评估策略的优劣。一个 `CAGR` 为 20% 但回撤高达 40% 的策略，其投资体验可能远差于一个 `CAGR` 为 15% 但回撤仅 5% 的策略。

**下一步**：当您列出风险类指标（如最大回撤、波动率、夏普比率、索提诺比率等）时，我们就可以将这些收益指标与之结合，对策略的风险调整后收益和整体稳健性做出真正的评价了。

以下是风险类指标的详细解释，已整理为 Markdown 表格格式。

### 风险类指标详解表

| 指标 | 说明 | 解读与深层含义 |
| :--- | :--- | :--- |
| **Max. Drawdown [%]**<br>最大回撤 | 在选定周期内，从任一历史峰值（最高点）到后续最低点的最大跌幅。 | **策略的“生存性”与“抗压能力”测试**。这是衡量**极端风险**的最重要指标之一。它告诉你策略可能面临的最糟糕情况（需要承担的最大账面亏损）。<br><br>**关键点**：<br>1. **越小越好**：回撤越小，说明策略在逆境中的抗风险能力越强，资金曲线越平稳。<br>2. **心理与风控**：巨大的回撤（如超过50%）不仅可能导致强制平仓，还会严重打击投资者信心。<br>3. **计算**：`(峰值 - 谷值) / 峰值 × 100%`。 |
| **Avg. Drawdown [%]**<br>平均回撤 | 所有回撤（从峰值到谷值的下跌）的平均幅度。 | **策略“常态”下跌程度的衡量**。它反映了策略在运行期间，每次发生下跌时平均的亏损深度。<br><br>**关键点**：<br>1. 与最大回撤结合看：如果最大回撤很大但平均回撤很小，说明策略大部分时间表现平稳，但曾遭遇过一次极端打击；反之，则说明策略频繁出现中等程度的下跌。<br>2. **作用**：帮助理解策略回撤的“普遍水平”，评估其日常风险。 |
| **Max. Drawdown Duration**<br>最长回撤持续时间 | 从净值创下历史新高后开始下跌，直到**完全恢复**并创出下一个新高所经历的最长时间。 | **衡量策略“恢复能力”与投资者“忍耐极限”**。它回答了“如果我在最糟糕的时刻买入，最长需要等待多久才能解套并开始盈利”这个残酷的问题。<br><br>**关键点**：<br>1. **时间价值**：过长的回撤期（例如数年）会极大消耗投资者的耐心和机会成本。<br>2. **与最大回撤的关系**：一个深但短的回撤，可能比一个浅但长的回撤更容易被接受。<br>3. **形式**：通常以天（Days）或年（Years）为单位表示。 |
| **Volatility (Ann.) [%]**<br>年化波动率 | 策略每日（或每周）收益率的标准差，再年化处理。 | **现代金融理论中“风险”的核心定义**。它衡量了策略收益的**离散程度**，即收益的“不确定性”或“波动性”。<br><br>**关键点**：<br>1. **原理**：波动率越高，说明策略的收益越不稳定，风险越高。<br>2. **作用**：<br>   - 是计算夏普比率等风险调整后收益指标的基础。<br>   - 影响资金曲线的平滑度，高波动率策略的资金曲线通常“锯齿”明显。<br>3. **计算**：通常基于日收益率计算样本标准差，再乘以年化因子（如√252）。 |

### 核心使用建议

1.  **首要关注**：**`Max. Drawdown [%]`** 是所有风险指标中 **最直观、最重要的**。它直接关联到策略的潜在最大亏损和风控底线。优秀的策略必须在控制最大回撤的前提下追求收益。

2.  **风险构成分析**：
    *   结合 **`Max. Drawdown`** 和 **`Avg. Drawdown`**，可以判断策略风险的**集中度**（是偶发极端风险还是常态风险）。
    *   结合 **`Max. Drawdown`** 和 **`Max. Drawdown Duration`**，可以评估策略风险的**痛苦程度**（跌得有多深，以及要熬多久）。

3.  **现代风险度量**：**`Volatility (Ann.)`** 是进行**策略间横向比较**和**构建投资组合**的理论基石。但它只衡量了波动的幅度，并未区分上行和下行波动。

4.  **风险与收益的平衡**：这些风险指标必须与之前的收益指标（特别是 **`CAGR`**）结合起来看。经典的分析组合是：
    *   **收益风险比**：`CAGR / Max. Drawdown`
    *   **夏普比率**：`(年化收益率 - 无风险利率) / 年化波动率`


### 风险调整收益指标详解表

| 指标 | 说明 | 解读与深层含义 | 参考值与评价标准 |
| :--- | :--- | :--- | :--- |
| **Sharpe Ratio**<br>夏普比率 | 每承担一单位**总风险**（波动率）所获得的**超额收益**。 | **最经典的风险调整收益指标**。衡量风险溢价与总风险之比。<br>**公式**：`(年化收益率 - 无风险利率) / 年化波动率`。<br><br>**核心要点**：<br>1. **分子**：超额收益 = 策略收益 - 无风险收益（如国债利率），代表承担风险的额外补偿。<br>2. **分母**：年化波动率（总风险），同时惩罚上行和下行波动。<br>3. **局限性**：假设收益服从正态分布，且对上行波动（盈利波动）的惩罚可能不符合投资者心理。 | **参考值**：<br>- **>1**：可接受，收益超过风险。<br>- **>2**：优秀，风险调整后收益良好。<br>- **>3**：卓越，顶级策略。<br><br>**注意**：该值高度依赖市场环境。在低利率或牛市中可能普遍偏高；不同资产类别间不可直接比较（如股票策略与债券策略）。 |
| **Sortino Ratio**<br>索提诺比率 | 每承担一单位**下行风险**所获得的**超额收益**。 | **夏普比率的改进版**，只惩罚对投资者不利的波动（下行波动）。<br>**公式**：`(年化收益率 - 无风险利率) / 下行偏差`。<br><br>**核心要点**：<br>1. **下行偏差**：仅计算收益率低于某个目标（通常为无风险利率或0）的波动率。<br>2. **更符合实际心理**：投资者通常只担心亏损的波动，不担心盈利的波动。<br>3. **优势**：对于有正偏态（偶尔大涨）的策略，此指标评价更公平。 | **参考值**：<br>- **>2**：通常被认为良好。<br><br>**注意**：由于分母（下行偏差）通常小于总波动率，索提诺比率数值一般高于夏普比率。比较时应确保不同策略使用相同的目标收益率（MAR）。 |
| **Calmar Ratio**<br>卡玛比率 | **年化收益**与**最大回撤**的比值。 | **专注极端风险**。衡量策略在承受最大回撤后，能带来多少收益补偿。<br>**公式**：`年化收益率 / 最大回撤`（常用）或 `(年化收益率 - 无风险利率) / 最大回撤`。<br><br>**核心要点**：<br>1. **直观**：直接回答“为获得年化收益，需忍受多大亏损？”<br>2. **对回撤敏感**：适合不能忍受大回撤的投资者。<br>3. **局限性**：基于单一历史最大回撤，可能不稳定；对回测周期长度敏感。 | **参考值**：<br>- **>0.5**：可接受。<br>- **>1**：较好，年化收益能覆盖最大回撤。<br>- **>2**：优秀。<br><br>**注意**：此指标对回测时长敏感，短期回测可能因未经历完整周期而高估。 |
| **Alpha [%]**<br>阿尔法 | 相对基准的**超额收益**，且与市场波动（Beta）无关的部分。 | **主动管理能力的体现**。源于资本资产定价模型（CAPM）。<br>**公式**：通过回归 `策略收益 - 无风险利率 = Alpha + Beta × (市场收益 - 无风险利率) + 误差` 得到。<br><br>**核心要点**：<br>1. **真实超额收益**：剥离市场涨跌（Beta）后，策略自身能力带来的收益。<br>2. **可持续性**：正Alpha代表可能具有持续竞争优势（选股、择时等）。<br>3. **显著性**：需检验Alpha是否显著不为零（通常看t统计量或p值）。 | **参考值**：<br>- **>0**：有正向超额收益。<br>- **年化Alpha > 5%**：通常被认为很强。<br><br>**注意**：Alpha的估计依赖正确的基准选择和模型设定；高Alpha可能源于未识别的风险暴露。 |
| **Beta**<br>贝塔系数 | 策略收益相对于市场基准收益的**敏感度/弹性**。 | **衡量市场系统性风险暴露**。<br>**公式**：`Beta = Cov(策略收益, 市场收益) / Var(市场收益)`。<br><br>**核心要点**：<br>1. **解释**：<br>   - **Beta = 1**：与市场同步波动。<br>   - **Beta > 1**：比市场波动更大（进攻型）。<br>   - **Beta < 1**：比市场波动更小（防御型）。<br>   - **Beta ≈ 0**：与市场无关（市场中性）。<br>2. **用途**：分解收益来源（Beta收益 vs Alpha收益）；调整组合风险暴露。 | **参考值**：<br>- **1**：市场中性（相对基准）。<br>- **0.5-1.5**：常见范围。<br><br>**注意**：Beta可能随时间变化；负Beta表示与市场反向，但极少见。 |

---

#### 核心使用建议

##### 1. 综合评估，勿依赖单一指标
- **互补性**：
  - **夏普 vs 索提诺**：若夏普较低但索提诺较高，说明策略下行风险控制好，但上行波动大（如趋势策略）。
  - **夏普 vs 卡玛**：若夏普高但卡玛低，说明策略常有小回撤，但曾有一次巨大回撤。
  - **Alpha vs Beta**：高Alpha伴随高Beta，可能超额收益主要来自承担更高市场风险，而非真正技能。

##### 2. 理解指标的计算前提与局限性
- **数据频率**：确保年化计算一致（如使用252个交易日）。
- **无风险利率**：夏普与索提诺对此敏感，需明确取值（如3个月国债利率）。
- **统计显著性**：Alpha和Beta需结合显著性检验（p值或置信区间）判断可靠性。

##### 3. 结合策略类型选择重点指标
- **对冲/市场中性策略**：重点关注Alpha和Beta（应接近0），夏普比率。
- **趋势/宏观策略**：重点关注索提诺比率（因常具正偏态）和卡玛比率（回撤控制）。
- **高频/套利策略**：重点关注夏普比率（通常极高）和最大回撤。

##### 4. 实战决策示例
假设两个股票策略：
- **策略A**：年化收益20%，最大回撤15%，夏普1.8，索提诺2.5，卡玛1.33，Alpha=12%，Beta=1.1。
- **策略B**：年化收益25%，最大回撤30%，夏普1.2，索提诺1.8，卡玛0.83，Alpha=8%，Beta=1.5。

**分析**：
- 虽然策略B收益更高，但其风险调整后收益（夏普、索提诺、卡玛）全面低于策略A。
- 策略B的Beta更高，说明其超额收益更多来自市场暴露（牛市表现好，熊市可能更差）。
- 对于风险厌恶型投资者，策略A是更优选择（更高的单位风险收益、更小回撤）。

---

#### 进阶思考：指标陷阱与应对

1. **过拟合导致虚假高指标**：回测中过度优化参数可能使所有指标都很漂亮，但实盘失效。应对：样本外测试、敏感性分析。
2. **幸存者偏差**：使用当前存续股票回测会高估历史表现。应对：使用历史当时存在的股票池。
3. **交易成本与滑点**：未充分考虑成本会高估收益，低估风险。应对：在回测中纳入保守的成本假设。
4. **市场环境变化**：策略可能只在特定市场环境下有效。应对：进行多周期回测（牛、熊、震荡市）。

这些风险调整收益指标是评估策略“性价比”的核心工具，但必须结合对策略逻辑、市场环境和潜在偏差的深入理解，才能做出稳健的投资决策。

#### （个人思考和理解）
##### 利率分类
1、无风险利率：不需要任何投资行为就能产生的利率（对标银行利率）
2、市场总利率：不使用策略，在某个市场投资产生的利率（市场总利率 = 市场额外利率 + 无风险利率） 
3、策略总利率：在某个市场使用了策略后产生的利率（策略总利率 = 无风险利率 + 市场额外利率*beta + 策略无风险利率（alpha））

##### 策略影响因子
主流量化策略建模方式假定：每种策略都有alpha和beta两个影响因子，alpha衡量策略带来的超额收益（简单粗暴），beta则衡量策略相对市场正常利率水平的激进度（比市场更高收益/风险）。
alpha = 策略总利率 - 无风险利率 - 市场额外利率*beta
Beta = Cov(策略收益, 市场收益) / Var(市场收益)
影响因子排列组合：
1、高alpha，高beta：策略虽然有高风险（beta高意味着市场下行时承担更大风险），但是有超高收益（高beta带来的市场上行时更高收益+高alpha带来的超额收益）。策略性价比较高
2、高alpha，低beta：策略收益与市场无关，类似统计套利，策略本身带来的无风险利率。总体性价比高
3、低alpha，高beta：策略不带来额外无风险利率，靠beta放大市场的收益率来盈利。总体性价比一般
4、低alpha，低beta：策略不带来额外无风险利率，也不能放大市场收益率，相当没有策略。总体性价比低

##### 风险调整收益指标速记

夏普比率：衡量每承担一单位风险（波动率）所获得的超额收益。缺点是将上行波动也视为风险的一种，不够符合直觉。重要指数：⭐⭐⭐⭐
索提诺比率： 衡量每承担一单位下行风险所获得的超额收益。计算公式更加符合风险与收益的定义。重要指数：⭐⭐⭐⭐⭐
卡玛比率：衡量策略在承受最大回撤后，能带来多少收益补偿。对回撤比例敏感时需关注。重要指数：⭐⭐⭐
阿尔法因子：策略带来的无风险额外收益。越高越好。重要指数：⭐⭐⭐⭐⭐
贝塔因子：策略带来的撬动市场波动的强度系数。越高越激进。重要指数：⭐⭐⭐⭐⭐


### 交易统计指标详解表

| 指标 | 说明 | 解读与深层含义 | 计算与注意事项 |
| :--- | :--- | :--- | :--- |
| **`# Trades`**<br>交易次数 | 回测期间内所有买卖交易的总次数（通常按开仓+平仓算一次完整交易）。 | **策略活跃度的基本度量**。<br>1. **策略类型判断**：高频策略>1000次/年；日内策略>100次/年；趋势策略可能<50次/年。<br>2. **统计显著性**：交易次数越多，回测结果越可靠（统计意义越强）。<br>3. **成本敏感度**：交易次数越多，总手续费和滑点成本影响越大。 | **注意**：需区分“交易次数”与“交易信号数”。有些策略生成信号后可能因风控未能成交。 |
| **`Win Rate [%]`**<br>胜率 | 盈利交易笔数占总交易笔数的百分比。 | **衡量策略的“正确率”**。<br>1. **心理体验**：高胜率（>60%）带来更好的交易体验和执行力。<br>2. **与盈亏比的关系**：胜率和盈亏比通常呈反比。需结合看：<br>   - 高胜率+低盈亏比：如做市策略、套利策略<br>   - 低胜率+高盈亏比：如趋势跟踪策略<br>3. **阈值**：>50%是基础要求，但并非绝对，盈亏比高的策略30-40%胜率也能盈利。 | `胜率 = 盈利交易笔数 / 总交易笔数 × 100%`<br>**注意**：“盈利”定义为扣除手续费和滑点后的净利润>0。 |
| **`Best Trade [%]`**<br>最佳交易 | 所有交易中，单笔收益率最高的交易的收益率。 | **策略的上行潜力**。<br>1. **盈利来源分析**：最佳交易是否异常值？是否依赖单次“黑天鹅”事件？<br>2. **策略一致性**：最佳交易收益率远高于平均交易，可能预示策略不稳定。<br>3. **与最大回撤关系**：最佳交易能否覆盖最大回撤？ | **注意**：警惕最佳交易是数据错误或特殊事件（如财报、并购）导致，这些在实盘中不可复制。 |
| **`Worst Trade [%]`**<br>最差交易 | 所有交易中，单笔亏损率最大的交易的亏损率。 | **策略的下行风险**。<br>1. **风控有效性**：最差交易反映了极端情况下的单笔损失，检查止损机制是否有效。<br>2. **与胜率关系**：即使胜率高，一次巨大亏损可能摧毁多次盈利。<br>3. **心理承受**：投资者能否承受这样的单笔亏损？ | **注意**：最差交易应与市场极端事件（如闪崩、流动性枯竭）关联分析。是否因流动性不足导致无法止损？ |
| **`Avg. Trade [%]`**<br>平均交易收益 | 所有交易收益率的算术平均值。 | **策略的平均盈利能力**。<br>1. **收益质量**：平均收益应显著大于0，且最好超过交易成本（手续费+滑点）的2-3倍。<br>2. **分布形态**：若平均收益>0，但中位数收益<0，说明收益分布严重右偏（靠少数大赢家）。<br>3. **统计检验**：平均收益是否显著大于0（t检验）？ | `平均收益 = 所有交易收益率之和 / 交易次数`<br>**注意**：收益率通常使用百分比表示，但计算期望值时需用小数。 |
| **`Profit Factor`**<br>利润因子 | 总盈利金额与总亏损金额的比值。 | **衡量策略的盈利效率**。<br>1. **核心指标**：>1表示总体盈利，<1表示总体亏损。<br>2. **解读**：<br>   - 1.0-1.5：边际盈利<br>   - 1.5-2.0：良好<br>   - 2.0-3.0：优秀<br>   - >3.0：卓越<br>3. **与胜率关系**：利润因子综合了胜率和盈亏比信息。 | `利润因子 = 总盈利金额 / \|总亏损金额\|` <br>**注意**：1）总盈利、总亏损均取绝对值；2）对交易成本敏感，需扣除成本后计算。 |
| **`Expectancy [%]`**<br>期望值 | 每笔交易的平均预期收益率。 | **策略的“数学期望”**，结合了胜率和盈亏比的核心指标。<br>1. **公式推导**：`期望值 = (胜率 × 平均盈利) - (败率 × 平均亏损)`<br>2. **实战意义**：>0是盈利的必要条件，数值越大，每笔交易的预期收益越高。<br>3. **资金管理基础**：用于计算凯利准则、最优仓位等。 | **注意**：期望值通常以百分比表示，但也可转换为金额。需用足够多的交易样本计算。 |
| **`SQN`**<br>系统质量数 | System Quality Number，由Van Tharp提出，衡量策略收益与风险的比率。 | **评估策略的稳健性和统计显著性**。<br>1. **公式**：`SQN = (平均收益 / 收益标准差) × √交易次数`<br>2. **解读**：<br>   - <1.6：策略质量较差<br>   - 1.6-2.0：一般<br>   - 2.0-3.0：良好<br>   - >3.0：优秀<br>   - >4.0：卓越<br>3. **优势**：结合了盈利能力和样本量，可用于比较不同频率的策略。 | **注意**：SQN对交易次数敏感，低频策略即使质量高也可能SQN较低。建议交易次数>100时使用。 |
| **`Kelly Criterion [%]`**<br>凯利准则 | 在给定胜率和盈亏比下，理论上使长期复利增长最大化的最优仓位比例。 | **资金管理的理论最优解**。<br>1. **公式**：`f* = (p × b - q) / b`，其中p=胜率，q=败率，b=盈亏比（平均盈利/平均亏损）。<br>2. **应用**：<br>   - 建议仓位 = 凯利值 × 可用资金<br>   - 通常使用“半凯利”或“1/4凯利”以降低风险<br>3. **局限性**：<br>   - 假设收益分布已知且稳定<br>   - 忽略交易成本、资金连续性<br>   - 可能建议激进仓位 | **注意**：凯利准则对参数敏感，微小估计误差可能导致巨大仓位变化。**切勿直接使用满凯利**。 |
| **`Exposure Time [%]`**<br>持仓时间比 | 策略持有头寸的时间占总回测时间的百分比。 | **衡量策略的市场暴露程度和资金利用率**。<br>1. **策略类型**：<br>   - 高频/日内：持仓时间比低（可能<10%）<br>   - 趋势/长线：持仓时间比高（可能>80%）<br>2. **风险关联**：持仓时间越长，暴露于市场风险的时间越长，可能经历更多回撤。<br>3. **与夏普比率**：持仓时间低可能夏普比率高（单位时间收益集中）。 | **计算**：`持仓时间比 = 总持仓时间 / 总回测时间 × 100%`<br>**注意**：对于多品种、多空对冲策略，净持仓可能接近零，但总持仓时间比仍高。 |

---

#### **核心使用建议**


##### 3. 常见问题诊断表

| 问题现象 | 可能原因 | 检查指标 |
|----------|----------|----------|
| **高胜率但低利润因子** | 盈亏比过低，平均盈利远小于平均亏损 | 平均交易收益、利润因子、最差交易 |
| **利润因子高但收益低** | 交易次数太少，或持仓时间比过低 | # Trades、Exposure Time、SQN |
| **最佳交易占比过高** | 收益依赖少数交易，策略可能不稳定 | 最佳交易 vs 平均交易、收益分布 |
| **SQN<1.6但期望值>0** | 交易次数不足或收益波动太大 | # Trades、收益标准差、最大回撤 |
| **凯利值>50%** | 胜率和盈亏比估计可能过于乐观，或未考虑风险 | 胜率、盈亏比、最差交易、回测周期 |

## 2025/12/4

1、数据处理、数据可视化、数据操作（各种指标计算使用的接口函数）
2、了解python提供的并行计算方式（向量化计算）
3、正常运行第一个策略回测，策略为双均线交叉策略
4、了解回测的代码逻辑，了解策略参数优化逻辑

## 2025/12/3

量化实战学习第一阶段开始：
配置量化Python环境，了解量化的软件生态（数据平台tushare、akshare等，回测平台vnpy、backtrader、backtesting等）
验证行情数据拉取代码